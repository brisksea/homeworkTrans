<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…±äº«è®¿é—® - ä½œä¸šä¸Šä¼ ç³»ç»Ÿ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .card {
      background: white;
      border-radius: 10px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      max-width: 500px;
      width: 100%;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      color: #666;
      text-align: center;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .share-name {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      word-break: break-all;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      text-align: center;
      letter-spacing: 2px;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
    }

    .share-info {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #e9ecef;
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-label {
      color: #666;
      font-size: 14px;
    }

    .info-value {
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-active {
      background: #d4edda;
      color: #155724;
    }

    .status-expired {
      background: #f8d7da;
      color: #721c24;
    }

    .status-limited {
      background: #fff3cd;
      color: #856404;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 12px;
      border-radius: 5px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 14px;
    }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 12px;
      border-radius: 5px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 14px;
    }

    .hidden {
      display: none;
    }

    .back-link {
      text-align: center;
      margin-top: 20px;
    }

    .back-link a {
      color: #667eea;
      text-decoration: none;
      font-size: 14px;
    }

    .back-link a:hover {
      text-decoration: underline;
    }

    .description {
      background: #e7f3ff;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .description-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }

    .description-content {
      color: #555;
      line-height: 1.6;
      font-size: 14px;
      white-space: pre-wrap;
    }

    /* æ–‡ä»¶åˆ—è¡¨æ ·å¼ */
    .file-list-section {
      margin-bottom: 20px;
    }

    .file-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e9ecef;
    }

    .file-list-title {
      font-weight: 600;
      color: #333;
      font-size: 16px;
    }

    .file-list-actions {
      display: flex;
      gap: 10px;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-outline {
      background: white;
      border: 1px solid #667eea;
      color: #667eea;
    }

    .btn-outline:hover {
      background: #667eea;
      color: white;
    }

    .btn-outline:disabled {
      border-color: #ccc;
      color: #ccc;
      cursor: not-allowed;
    }

    .btn-outline:disabled:hover {
      background: white;
    }

    .file-list {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #e9ecef;
      border-radius: 8px;
    }

    .file-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      border-bottom: 1px solid #f0f0f0;
      transition: background 0.2s;
    }

    .file-item:last-child {
      border-bottom: none;
    }

    .file-item:hover {
      background: #f8f9fa;
    }

    .file-item input[type="checkbox"] {
      margin-right: 12px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .file-icon {
      margin-right: 10px;
      font-size: 18px;
    }

    .file-info {
      flex: 1;
      min-width: 0;
    }

    .file-name {
      color: #333;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .file-size {
      color: #999;
      font-size: 12px;
      margin-top: 2px;
    }

    .file-download-btn {
      padding: 4px 10px;
      font-size: 12px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .file-download-btn:hover {
      background: #218838;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 10px;
      font-size: 13px;
      color: #666;
      flex-wrap: wrap;
    }

    .breadcrumb-item {
      color: #667eea;
      cursor: pointer;
      text-decoration: none;
    }

    .breadcrumb-item:hover {
      text-decoration: underline;
    }

    .breadcrumb-separator {
      color: #999;
    }

    .breadcrumb-current {
      color: #333;
      font-weight: 500;
    }

    .loading {
      text-align: center;
      padding: 30px;
      color: #666;
    }

    .empty-message {
      text-align: center;
      padding: 30px;
      color: #999;
      font-size: 14px;
    }

    .select-all-wrapper {
      padding: 10px 15px;
      background: #f8f9fa;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      align-items: center;
    }

    .select-all-wrapper label {
      margin: 0;
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 14px;
      color: #555;
    }

    .select-all-wrapper input {
      margin-right: 10px;
    }

    .selected-count {
      margin-left: auto;
      font-size: 12px;
      color: #667eea;
    }
  </style>
</head>
<body>
  <div class="card">
    <!-- è¾“å…¥å…±äº«ç ç•Œé¢ -->
    <div id="codeInputSection">
      <h1>å…±äº«è®¿é—®</h1>
      <p class="subtitle">è¾“å…¥å…±äº«ç è®¿é—®æ–‡ä»¶æˆ–ä½œä¸š</p>

      <div id="errorMessage" class="error-message hidden"></div>

      <div class="form-group">
        <label for="shareCode">å…±äº«ç </label>
        <input type="text" id="shareCode" placeholder="è¯·è¾“å…¥å…±äº«ç ">
      </div>

      <button class="btn btn-primary" onclick="verifyShareCode()">è®¿é—®å…±äº«å†…å®¹</button>

      <div class="back-link">
        <a href="/">è¿”å›é¦–é¡µ</a>
      </div>
    </div>

    <!-- å…±äº«ä¿¡æ¯æ˜¾ç¤ºç•Œé¢ -->
    <div id="shareInfoSection" class="hidden">
      <h1 id="shareTitle">å…±äº«æ–‡ä»¶</h1>
      <div class="share-name" id="shareNameDisplay"></div>

      <div id="successMessage" class="success-message hidden"></div>

      <!-- æè¿°ä¿¡æ¯ -->
      <div id="descriptionSection" class="description hidden">
        <div class="description-title">æè¿°</div>
        <div class="description-content" id="descriptionContent"></div>
      </div>

      <!-- å…±äº«ä¿¡æ¯ -->
      <div class="share-info">
        <div class="info-item">
          <span class="info-label">è®¿é—®æ¬¡æ•°</span>
          <span class="info-value" id="accessInfo"></span>
        </div>
        <div class="info-item hidden" id="expireItem">
          <span class="info-label">è¿‡æœŸæ—¶é—´</span>
          <span class="info-value" id="expireTime"></span>
        </div>
      </div>

      <!-- ç›®å½•æ–‡ä»¶åˆ—è¡¨ -->
      <div id="fileListSection" class="file-list-section hidden">
        <div class="file-list-header">
          <span class="file-list-title">æ–‡ä»¶åˆ—è¡¨</span>
          <div class="file-list-actions">
            <button class="btn-sm btn-outline" id="downloadSelectedBtn" onclick="downloadSelected()" disabled>
              ä¸‹è½½é€‰ä¸­ (<span id="selectedCount">0</span>)
            </button>
            <button class="btn-sm btn-outline" onclick="downloadAll()">ä¸‹è½½å…¨éƒ¨</button>
          </div>
        </div>
        <div id="breadcrumb" class="breadcrumb hidden"></div>
        <div class="file-list" id="fileList">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </div>

      <button class="btn btn-success" id="downloadAllBtn" onclick="downloadShare()">ä¸‹è½½æ–‡ä»¶</button>

      <div class="back-link">
        <a href="javascript:void(0)" onclick="resetPage()">è®¿é—®å…¶ä»–å…±äº«</a> |
        <a href="/">è¿”å›é¦–é¡µ</a>
      </div>
    </div>
  </div>

  <script>
    let currentShareCode = '';
    let currentShareType = '';
    let currentPath = '';
    let selectedFiles = new Set();

    // ä»URLè·å–å…±äº«ç 
    window.onload = function() {
      const urlParams = new URLSearchParams(window.location.search);
      const shareCode = urlParams.get('code');
      if (shareCode) {
        document.getElementById('shareCode').value = shareCode;
        verifyShareCode();
      }
    };

    // éªŒè¯å…±äº«ç 
    async function verifyShareCode() {
      const shareCode = document.getElementById('shareCode').value.trim();

      if (!shareCode) {
        showError('è¯·è¾“å…¥å…±äº«ç ');
        return;
      }

      try {
        const response = await fetch(`/api/shares/${shareCode}/info`);
        const data = await response.json();

        if (!data.success) {
          showError(data.message);
          return;
        }

        // ä¿å­˜å…±äº«ç å’Œç±»å‹
        currentShareCode = shareCode;
        currentShareType = data.share.shareType;

        // æ˜¾ç¤ºå…±äº«ä¿¡æ¯
        displayShareInfo(data.share);

        // åˆ‡æ¢ç•Œé¢
        document.getElementById('codeInputSection').classList.add('hidden');
        document.getElementById('shareInfoSection').classList.remove('hidden');

        // å¦‚æœæ˜¯ç›®å½•ç±»å‹ï¼ŒåŠ è½½æ–‡ä»¶åˆ—è¡¨
        if (currentShareType === 'directory') {
          document.getElementById('fileListSection').classList.remove('hidden');
          document.getElementById('downloadAllBtn').classList.add('hidden');
          loadFileList('');
        }

      } catch (error) {
        console.error('éªŒè¯å¤±è´¥:', error);
        showError('éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
      }
    }

    // æ˜¾ç¤ºå…±äº«ä¿¡æ¯
    function displayShareInfo(share) {
      // æ ¹æ®ç±»å‹è®¾ç½®æ ‡é¢˜
      const titleMap = {
        'assignment': 'å…±äº«ä½œä¸š',
        'file': 'å…±äº«æ–‡ä»¶',
        'directory': 'å…±äº«ç›®å½•',
        'multiple': 'å…±äº«æ–‡ä»¶'
      };
      document.getElementById('shareTitle').textContent = titleMap[share.shareType] || 'å…±äº«æ–‡ä»¶';

      // å…±äº«åç§°ï¼ˆé†’ç›®æ˜¾ç¤ºï¼‰
      document.getElementById('shareNameDisplay').textContent = share.shareName || 'æœªå‘½åå…±äº«';

      // è®¿é—®æ¬¡æ•°
      const accessText = share.maxAccess > 0
        ? `${share.accessCount} / ${share.maxAccess}`
        : `${share.accessCount}ï¼ˆä¸é™ï¼‰`;
      document.getElementById('accessInfo').textContent = accessText;

      // è¿‡æœŸæ—¶é—´
      if (share.expireAt) {
        const expireDate = new Date(share.expireAt);
        document.getElementById('expireTime').textContent = expireDate.toLocaleString('zh-CN');
        document.getElementById('expireItem').classList.remove('hidden');
      }

      // æè¿°
      if (share.description) {
        document.getElementById('descriptionContent').textContent = share.description;
        document.getElementById('descriptionSection').classList.remove('hidden');
      }
    }

    // åŠ è½½æ–‡ä»¶åˆ—è¡¨
    async function loadFileList(subPath) {
      currentPath = subPath;
      selectedFiles.clear();
      updateSelectedCount();

      const fileListDiv = document.getElementById('fileList');
      fileListDiv.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

      try {
        let url = `/api/shares/${currentShareCode}/files`;
        if (subPath) {
          url += `?subPath=${encodeURIComponent(subPath)}`;
        }

        const response = await fetch(url);
        const data = await response.json();

        if (!data.success) {
          fileListDiv.innerHTML = `<div class="empty-message">${data.message}</div>`;
          return;
        }

        // æ›´æ–°é¢åŒ…å±‘
        updateBreadcrumb(subPath);

        // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
        renderFileList(data.files);

      } catch (error) {
        console.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error);
        fileListDiv.innerHTML = '<div class="empty-message">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
      }
    }

    // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
    function updateBreadcrumb(subPath) {
      const breadcrumbDiv = document.getElementById('breadcrumb');

      if (!subPath) {
        breadcrumbDiv.classList.add('hidden');
        return;
      }

      breadcrumbDiv.classList.remove('hidden');

      const parts = subPath.split('/').filter(p => p);
      let html = `<span class="breadcrumb-item" onclick="loadFileList('')">æ ¹ç›®å½•</span>`;

      let currentPathBuild = '';
      parts.forEach((part, index) => {
        currentPathBuild += (currentPathBuild ? '/' : '') + part;
        html += `<span class="breadcrumb-separator">/</span>`;

        if (index === parts.length - 1) {
          html += `<span class="breadcrumb-current">${part}</span>`;
        } else {
          const pathForClick = currentPathBuild;
          html += `<span class="breadcrumb-item" onclick="loadFileList('${pathForClick}')">${part}</span>`;
        }
      });

      breadcrumbDiv.innerHTML = html;
    }

    // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
    function renderFileList(files) {
      const fileListDiv = document.getElementById('fileList');

      if (!files || files.length === 0) {
        fileListDiv.innerHTML = '<div class="empty-message">æ­¤ç›®å½•ä¸ºç©º</div>';
        return;
      }

      let html = `
        <div class="select-all-wrapper">
          <label>
            <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
            å…¨é€‰
          </label>
          <span class="selected-count" id="selectedCountText">å·²é€‰æ‹© 0 ä¸ªæ–‡ä»¶</span>
        </div>
      `;

      files.forEach(file => {
        const icon = file.isDirectory ? 'ğŸ“' : getFileIcon(file.name);
        const sizeText = file.isDirectory ? '' : formatFileSize(file.size);

        html += `
          <div class="file-item">
            <input type="checkbox"
              class="file-checkbox"
              data-path="${escapeHtml(file.path)}"
              data-is-dir="${file.isDirectory}"
              onchange="toggleFileSelection(this)">
            <span class="file-icon">${icon}</span>
            <div class="file-info">
              ${file.isDirectory
                ? `<div class="file-name" style="cursor:pointer;color:#667eea;" onclick="loadFileList('${escapeHtml(file.path)}')">${escapeHtml(file.name)}</div>`
                : `<div class="file-name">${escapeHtml(file.name)}</div>`
              }
              ${sizeText ? `<div class="file-size">${sizeText}</div>` : ''}
            </div>
            ${!file.isDirectory
              ? `<button class="file-download-btn" onclick="downloadSingleFile('${escapeHtml(file.path)}')">ä¸‹è½½</button>`
              : ''
            }
          </div>
        `;
      });

      fileListDiv.innerHTML = html;
    }

    // è·å–æ–‡ä»¶å›¾æ ‡
    function getFileIcon(filename) {
      const ext = filename.split('.').pop().toLowerCase();
      const iconMap = {
        'pdf': 'ğŸ“„',
        'doc': 'ğŸ“', 'docx': 'ğŸ“',
        'xls': 'ğŸ“Š', 'xlsx': 'ğŸ“Š',
        'ppt': 'ğŸ“½ï¸', 'pptx': 'ğŸ“½ï¸',
        'jpg': 'ğŸ–¼ï¸', 'jpeg': 'ğŸ–¼ï¸', 'png': 'ğŸ–¼ï¸', 'gif': 'ğŸ–¼ï¸', 'bmp': 'ğŸ–¼ï¸',
        'mp3': 'ğŸµ', 'wav': 'ğŸµ', 'flac': 'ğŸµ',
        'mp4': 'ğŸ¬', 'avi': 'ğŸ¬', 'mkv': 'ğŸ¬', 'mov': 'ğŸ¬',
        'zip': 'ğŸ“¦', 'rar': 'ğŸ“¦', '7z': 'ğŸ“¦', 'tar': 'ğŸ“¦', 'gz': 'ğŸ“¦',
        'txt': 'ğŸ“ƒ',
        'html': 'ğŸŒ', 'htm': 'ğŸŒ',
        'js': 'âš™ï¸', 'css': 'ğŸ¨', 'json': 'ğŸ“‹',
        'py': 'ğŸ', 'java': 'â˜•', 'c': 'ğŸ’»', 'cpp': 'ğŸ’»', 'h': 'ğŸ’»'
      };
      return iconMap[ext] || 'ğŸ“„';
    }

    // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // HTMLè½¬ä¹‰
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // åˆ‡æ¢æ–‡ä»¶é€‰æ‹©
    function toggleFileSelection(checkbox) {
      const path = checkbox.dataset.path;
      if (checkbox.checked) {
        selectedFiles.add(path);
      } else {
        selectedFiles.delete(path);
      }
      updateSelectedCount();
      updateSelectAllState();
    }

    // å…¨é€‰/å–æ¶ˆå…¨é€‰
    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAllCheckbox').checked;
      const checkboxes = document.querySelectorAll('.file-checkbox');

      checkboxes.forEach(cb => {
        cb.checked = selectAll;
        const path = cb.dataset.path;
        if (selectAll) {
          selectedFiles.add(path);
        } else {
          selectedFiles.delete(path);
        }
      });

      updateSelectedCount();
    }

    // æ›´æ–°å…¨é€‰çŠ¶æ€
    function updateSelectAllState() {
      const checkboxes = document.querySelectorAll('.file-checkbox');
      const checkedCount = document.querySelectorAll('.file-checkbox:checked').length;
      const selectAllCb = document.getElementById('selectAllCheckbox');

      if (selectAllCb) {
        selectAllCb.checked = checkboxes.length > 0 && checkedCount === checkboxes.length;
        selectAllCb.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
      }
    }

    // æ›´æ–°é€‰ä¸­æ•°é‡æ˜¾ç¤º
    function updateSelectedCount() {
      const count = selectedFiles.size;
      const selectedCountEl = document.getElementById('selectedCount');
      const selectedCountTextEl = document.getElementById('selectedCountText');
      const downloadSelectedBtnEl = document.getElementById('downloadSelectedBtn');
      if (selectedCountEl) selectedCountEl.textContent = count;
      if (selectedCountTextEl) selectedCountTextEl.textContent = `å·²é€‰æ‹© ${count} ä¸ªæ–‡ä»¶`;
      if (downloadSelectedBtnEl) downloadSelectedBtnEl.disabled = count === 0;
    }

    // ä¸‹è½½å•ä¸ªæ–‡ä»¶
    function downloadSingleFile(filePath) {
      window.location.href = `/api/shares/${currentShareCode}/download-file?filePath=${encodeURIComponent(filePath)}`;
      showSuccess('ä¸‹è½½å·²å¼€å§‹...');
    }

    // ä¸‹è½½é€‰ä¸­çš„æ–‡ä»¶
    async function downloadSelected() {
      if (selectedFiles.size === 0) {
        showError('è¯·å…ˆé€‰æ‹©è¦ä¸‹è½½çš„æ–‡ä»¶');
        return;
      }

      try {
        // åˆ›å»ºè¡¨å•æäº¤ä¸‹è½½
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/api/shares/${currentShareCode}/download-selected`;
        form.style.display = 'none';

        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'files';
        input.value = JSON.stringify(Array.from(selectedFiles));
        form.appendChild(input);

        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);

        showSuccess('æ­£åœ¨æ‰“åŒ…ä¸‹è½½...');
      } catch (error) {
        console.error('ä¸‹è½½å¤±è´¥:', error);
        showError('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }

    // ä¸‹è½½å…¨éƒ¨æ–‡ä»¶
    function downloadAll() {
      window.location.href = `/api/shares/${currentShareCode}/download`;
      showSuccess('æ­£åœ¨æ‰“åŒ…ä¸‹è½½å…¨éƒ¨æ–‡ä»¶...');
    }

    // ä¸‹è½½å…±äº«å†…å®¹
    function downloadShare() {
      if (!currentShareCode) {
        showError('å…±äº«ç æ— æ•ˆ');
        return;
      }

      // ç›´æ¥è·³è½¬åˆ°ä¸‹è½½é“¾æ¥
      window.location.href = `/api/shares/${currentShareCode}/download`;

      // æ˜¾ç¤ºæç¤ºä¿¡æ¯
      showSuccess('ä¸‹è½½å·²å¼€å§‹...');
    }

    // é‡ç½®é¡µé¢
    function resetPage() {
      currentShareCode = '';
      currentShareType = '';
      currentPath = '';
      selectedFiles.clear();
      document.getElementById('shareCode').value = '';
      document.getElementById('codeInputSection').classList.remove('hidden');
      document.getElementById('shareInfoSection').classList.add('hidden');
      document.getElementById('errorMessage').classList.add('hidden');
      document.getElementById('successMessage').classList.add('hidden');
      document.getElementById('descriptionSection').classList.add('hidden');
      document.getElementById('expireItem').classList.add('hidden');
      document.getElementById('fileListSection').classList.add('hidden');
      document.getElementById('downloadAllBtn').classList.remove('hidden');
    }

    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');

      setTimeout(() => {
        errorDiv.classList.add('hidden');
      }, 3000);
    }

    // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
    function showSuccess(message) {
      const successDiv = document.getElementById('successMessage');
      successDiv.textContent = message;
      successDiv.classList.remove('hidden');

      setTimeout(() => {
        successDiv.classList.add('hidden');
      }, 3000);
    }

    // å›è½¦é”®æäº¤
    document.getElementById('shareCode').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        verifyShareCode();
      }
    });
  </script>
</body>
</html>
