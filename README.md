# 作业上传系统

一个完整的学生作业上传管理系统，支持多教师、多班级、密码验证和文件管理。

## 功能特点

### 教师端功能
- ✅ 教师注册与登录（**需真实姓名在白名单中**）
- ✅ **教师自助修改密码**
- ✅ 创建和管理多个班级
- ✅ **班级软删除（删除后进入历史记录，管理员可彻底删除）**
- ✅ 批量录入学生信息（学号+姓名）
- ✅ **单个/批量删除学生**
- ✅ 为班级创建作业上传密码
- ✅ **作业描述功能（可选添加作业说明、要求等信息）**
- ✅ **编辑作业（修改作业名称、密码、截止时间、描述等）**
- ✅ **创建临时作业（无需班级，学生无需验证学号）**
- ✅ **临时作业关联到班级（后续匹配学号）**
- ✅ 设置作业截止日期
- ✅ 查看学生作业提交情况（区分普通作业和临时作业）
- ✅ **批量下载作业（打包为 ZIP 文件）**
- ✅ **删除作业（删除前需确认，将删除所有已提交文件）**
- ✅ 支持多个教师同时使用
- ✅ **一体化界面（班级列表直接展开管理，无需标签页切换）**

### 管理员功能
- ✅ **管理员登录**
- ✅ **查看系统统计信息（教师、班级、学生、作业、文件数量）**
- ✅ **查看所有教师账号及其管理的班级（包括已删除的班级）**
- ✅ **重置教师密码（为教师账号设置新密码）**
- ✅ **彻底删除班级（硬删除，包括所有学生、作业和文件）**
- ✅ **监控系统整体运行状态**

### 学生端功能
- ✅ 通过密码访问作业上传
- ✅ 密码有效期验证（截止日期检查）
- ✅ **查看作业描述信息**
- ✅ **学号验证（必须在班级名单中）**
- ✅ **临时作业无需验证学号，直接上传**
- ✅ **文件自动重命名为学号_姓名.扩展名（普通作业）或学号.扩展名（临时作业）**
- ✅ 文件覆盖确认提示
- ✅ 支持拖拽上传

## 技术栈

- **后端**: Node.js + Express
- **数据库**: SQLite
- **文件上传**: Multer
- **文件压缩**: Archiver
- **认证**: express-session + bcryptjs
- **前端**: 原生 HTML + CSS + JavaScript

## 安装与运行

### 1. 安装依赖

```bash
npm install
```

### 2. 启动服务器

```bash
npm start
```

或使用开发模式（自动重启）：

```bash
npm run dev
```

### 3. 访问系统

服务器启动后，在浏览器中访问：

- **教师端**: http://localhost:3010/teacher.html
- **学生端**: http://localhost:3010/student.html
- **管理员端**: http://localhost:3010/admin.html

## 默认账号

### 教师账号
- **用户名**: teacher
- **密码**: 123456

### 管理员账号
- **用户名**: admin
- **密码**: admin123

## 使用流程

### 管理员操作流程

1. **登录系统**
   - 访问管理员端页面
   - 使用默认管理员账号登录（admin / admin123）

2. **查看系统概览**
   - 教师总数、班级总数、学生总数
   - 作业总数、文件上传数

3. **管理教师账号**
   - 查看所有教师账号
   - 查看每个教师管理的班级（包括已删除的班级）
   - **重置教师密码**：点击教师卡片右上角的"重置密码"按钮
   - 输入新密码（至少6位）
   - 确认密码后即可完成重置

4. **管理已删除的班级**
   - 已删除的班级以红色背景显示，带有[已删除]标记
   - 点击"彻底删除"按钮可永久删除班级及其所有数据
   - **此操作不可恢复，将删除班级的所有学生、作业和文件**

5. **维护教师白名单**
   - 编辑 `teachers_whitelist.txt` 文件
   - 每行一个教师真实姓名
   - 只有在白名单中的姓名才能注册

### 教师操作流程

1. **登录系统**
   - 使用默认账号或注册新账号登录
   - **注意：注册时真实姓名必须在 `teachers_whitelist.txt` 文件中**

2. **创建班级**
   - 点击"创建班级"按钮
   - 输入班级名称

3. **管理学生**
   - 在班级列表中点击"学生管理"按钮
   - **批量添加学生**，格式：`学号 姓名`（每行一个）
   - 示例：
     ```
     20240101 张三
     20240102 李四
     20240103 王五
     ```
   - **删除学生**：勾选学生后点击"批量删除选中学生"，或点击单个学生的"删除"按钮

4. **创建作业**
   - 在班级列表中点击"作业管理"按钮
   - 点击"创建新作业"
   - 填写作业名称、上传密码、截止时间
   - **可选填写作业描述**（作业要求、注意事项等）
   - 系统会自动生成随机密码，也可以自定义
   - **密码唯一性检查**：系统会检查密码是否与其他有效作业重复

5. **编辑作业**
   - 在作业列表中点击"编辑"按钮
   - 可修改作业名称、上传密码、截止时间、作业描述
   - **修改密码时自动检查是否与其他有效作业重复**
   - 修改后立即生效，学生访问时将使用新的信息

6. **创建临时作业**
   - 点击"创建临时作业"按钮
   - 设置作业名称、密码和截止时间
   - **可选填写作业描述**
   - 临时作业不需要绑定班级，学生上传时无需验证学号
   - 文件自动命名为"学号.扩展名"
   - 可在临时作业列表中点击"关联班级"将其转为普通作业

7. **查看提交情况**
   - 在作业列表中点击"查看提交"
   - **普通作业**：显示班级所有学生的提交状态（已提交/未提交）
   - **临时作业**：显示所有已提交的学号和文件
   - 显示提交时间和文件名

8. **批量下载作业**
   - 在作业列表中点击"批量下载"按钮
   - 或在查看提交情况页面点击"批量下载所有作业"
   - 自动下载包含所有已提交作业的 ZIP 压缩包

9. **删除作业**
   - 在作业列表中点击"删除"按钮
   - 系统会弹出确认对话框
   - 确认后将删除作业记录、上传记录和所有文件
   - **此操作不可恢复，请谨慎操作**

10. **删除班级**
   - 在班级列表中点击"删除班级"按钮
   - 确认后班级将被软删除（进入历史记录）
   - 教师端不再显示该班级
   - 管理员可以查看已删除的班级，并选择是否彻底删除

11. **修改个人密码**
   - 点击页面右上角的"修改密码"按钮
   - 输入原密码和新密码（至少6位）
   - 确认新密码后即可完成修改

### 学生操作流程

1. **输入密码**
   - 访问学生端页面
   - 输入教师提供的上传密码

2. **上传作业**
   - 输入学号
   - **普通作业**：系统自动验证学号是否在班级中，验证通过后显示学生姓名
   - **临时作业**：无需验证学号，直接上传
   - 选择文件
     - 普通作业：文件将自动重命名为"学号_姓名.扩展名"
     - 临时作业：文件将自动重命名为"学号.扩展名"
   - 点击上传

3. **文件覆盖**
   - 如果已上传过同名文件，会提示是否覆盖
   - 确认后即可覆盖旧文件

## 目录结构

```
homeworkTrans/
├── database.js            # 数据库配置和初始化
├── server.js              # 服务器主程序
├── package.json           # 项目配置
├── teachers_whitelist.txt # **教师白名单文件**
├── homework.db            # SQLite 数据库（运行后生成）
├── public/                # 静态文件目录
│   ├── index.html        # 首页（身份选择）
│   ├── teacher.html      # 教师端页面
│   ├── student.html      # 学生端页面
│   └── admin.html        # **管理员端页面**
```
uploads/
├── teacher_1/
│   ├── assignment_1/
│   │   ├── 20240101_张三.zip
│   │   ├── 20240102_李四.pdf
│   │   └── ...
│   ├── assignment_2/
│   │   └── ...
│   └── ...
├── teacher_2/
│   └── ...
└── ...
```
```

## 数据库设计

- **teachers**: 教师表（用户名、密码、姓名）
- **admins**: 管理员表（用户名、密码、姓名）
- **classes**: 班级表（教师ID、班级名称）
- **students**: 学生表（班级ID、学号、姓名）
- **assignments**: 作业表（教师ID、班级ID（可为null）、密码、截止时间、作业名称、是否为临时作业）
- **uploads**: 上传记录表（作业ID、学号、文件名、上传时间）

## API 接口

### 教师端 API
- `POST /api/teacher/login` - 教师登录
- `POST /api/teacher/register` - **教师注册（验证白名单）**
- `POST /api/teacher/logout` - 退出登录
- `GET /api/teacher/check` - 检查登录状态
- `POST /api/teacher/change-password` - **教师修改密码**
- `POST /api/classes` - 创建班级
- `GET /api/classes` - 获取班级列表
- `POST /api/classes/:classId/students/batch` - 批量添加学生
- `GET /api/classes/:classId/students` - 获取学生列表
- `POST /api/assignments` - 创建作业
- `POST /api/assignments/temp` - **创建临时作业（无需班级）**
- `PUT /api/assignments/:assignmentId` - **编辑作业（修改名称、密码、截止时间、描述）**
- `GET /api/assignments/temp` - **获取教师的所有临时作业**
- `PUT /api/assignments/:assignmentId/link-class` - **关联临时作业到班级**
- `GET /api/classes/:classId/assignments` - 获取作业列表
- `GET /api/assignments/:assignmentId/submissions` - 查看提交情况
- `GET /api/assignments/:assignmentId/download` - **批量下载作业**
- `DELETE /api/assignments/:assignmentId` - **删除作业（含所有文件）**
- `DELETE /api/classes/:classId` - **软删除班级（进入历史记录）**
- `DELETE /api/students/:studentId` - **删除单个学生**
- `DELETE /api/classes/:classId/students/batch` - **批量删除学生**

### 管理员 API
- `POST /api/admin/login` - **管理员登录**
- `POST /api/admin/logout` - **退出登录**
- `GET /api/admin/check` - **检查登录状态**
- `GET /api/admin/teachers` - **获取所有教师及其班级（包括已删除的班级）**
- `GET /api/admin/stats` - **获取系统统计信息**
- `POST /api/admin/reset-teacher-password` - **重置教师密码**
- `DELETE /api/admin/classes/:classId` - **彻底删除班级（硬删除，包括所有数据和文件）**

### 学生端 API
- `POST /api/student/verify` - 验证上传密码
- `POST /api/student/verify-student-id` - **验证学号是否在班级中**
- `POST /api/student/check-file` - 检查文件是否存在
- `POST /api/student/upload` - 上传文件（自动重命名）

## 注意事项

1. **密码安全**:
   - 教师密码使用 bcrypt 加密存储
   - 教师可以自助修改密码，需要输入原密码验证
   - 管理员可以为教师重置密码，无需原密码
   - 新密码长度至少6位
2. **教师注册**: 注册时需验证真实姓名是否在 `teachers_whitelist.txt` 白名单中
3. **学号验证**: 普通作业中，学生必须在班级名单中才能上传作业；临时作业无需验证学号
4. **文件命名**:
   - 普通作业：上传的文件自动重命名为"学号_姓名.扩展名"
   - 临时作业：上传的文件自动重命名为"学号.扩展名"
5. **临时作业**: 适用于教师来不及创建班级的情况，学生可以直接上传，后续教师可以关联到班级进行学号匹配
6. **文件组织**: 使用层级目录结构 `uploads/teacher_X/assignment_Y/`，便于管理和备份
7. **批量下载**: 直接压缩整个作业目录，包含所有学生提交的文件
8. **截止日期**: 超过截止日期后，学生无法通过密码验证
9. **数据库**: 使用 SQLite，数据存储在 `homework.db` 文件中
10. **管理员权限**: 管理员可以查看所有教师和班级信息
11. **删除作业**: 删除作业会永久删除所有相关记录和文件，此操作不可恢复，请谨慎操作

## 扩展功能建议

- [x] ~~文件下载功能（教师批量下载学生作业）~~ ✅ 已实现
- [x] ~~临时作业功能（无需班级，后续可关联）~~ ✅ 已实现
- [x] ~~作业编辑功能（修改作业信息）~~ ✅ 已实现
- [x] ~~班级软删除功能~~ ✅ 已实现
- [x] ~~学生批量删除功能~~ ✅ 已实现
- [ ] 文件类型限制
- [ ] 文件大小限制
- [ ] 邮件通知功能
- [ ] 学生作业评分功能
- [ ] 作业评语功能
- [ ] 导出提交记录（Excel）

## 许可证

ISC
